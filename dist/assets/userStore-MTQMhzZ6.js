import{m as j,r as u,f as p}from"./index-Bpd1Qgob.js";const b=j("user",()=>{const d=u(!1),o=u(0),i=u([]),r=u([]),a=u([{id:"1",name:"零食",points:20,description:"美味零食一包"},{id:"2",name:"小玩具",points:50,description:"精美小玩具一个"},{id:"3",name:"大玩具",points:100,description:"超值大玩具一个"}]),m=p(()=>{const t=new Date().toISOString().slice(0,10);return i.value.filter(e=>e.date===t)}),f=p(()=>{const t=new Date().toISOString().slice(0,10);return i.value.filter(e=>e.date===t&&e.completionLevel!==null).reduce((e,n)=>e+n.points,0)});function v(t,e){return t==="xumingxi"&&e==="20160104"?(d.value=!0,$(),!0):!1}function g(){d.value=!1,s()}function h(){const t=new Date().toISOString().slice(0,10);i.value.some(e=>e.date===t)||(i.value.push({id:`chinese-${t}`,subject:"chinese",subjectName:"语文",date:t,completionLevel:null,points:0},{id:`math-${t}`,subject:"math",subjectName:"数学",date:t,completionLevel:null,points:0},{id:`english-${t}`,subject:"english",subjectName:"英语",date:t,completionLevel:null,points:0}),s())}function S(t,e){const n=i.value.find(c=>c.id===t);if(n){n.completionLevel!==null&&(o.value-=n.points),n.completionLevel=e,n.points=e==="low"?1:e==="medium"?2:3,o.value+=n.points;const c={id:`record-${Date.now()}`,date:new Date().toISOString(),description:`${n.subjectName}任务完成（${e==="low"?"低":e==="medium"?"中":"高"}）`,points:n.points,type:"task"};r.value.push(c),s()}}function I(t){const e=a.value.find(n=>n.id===t);if(e&&o.value>=e.points){o.value-=e.points;const n={id:`record-${Date.now()}`,date:new Date().toISOString(),description:`兑换${e.name}`,points:-e.points,type:"exchange"};return r.value.push(n),s(),!0}return!1}function w(t){o.value=Math.max(0,o.value+t);const e={id:`record-${Date.now()}`,date:new Date().toISOString(),description:"积分调整",points:t,type:"exchange"};r.value.push(e),s()}function x(t,e,n,c){const l=a.value.find(L=>L.id===t);l&&(l.name=e,l.points=n,l.description=c,s())}function D(t,e,n){const c={id:`item-${Date.now()}`,name:t,points:e,description:n};a.value.push(c),s()}function y(t){a.value=a.value.filter(e=>e.id!==t),s()}function s(){const t={currentPoints:o.value,tasks:i.value,pointRecords:r.value,exchangeItems:a.value};localStorage.setItem("userData",JSON.stringify(t))}function $(){const t=localStorage.getItem("userData");if(t)try{const e=JSON.parse(t);o.value=e.currentPoints||0,i.value=e.tasks||[],r.value=e.pointRecords||[],a.value=e.exchangeItems||a.value}catch(e){console.error("Failed to load data from localStorage:",e)}}return{isLoggedIn:d,currentPoints:o,tasks:i,pointRecords:r,exchangeItems:a,todayTasks:m,todayPoints:f,login:v,logout:g,initializeTodayTasks:h,updateTaskCompletion:S,exchangeItem:I,adjustPoints:w,updateExchangeItem:x,addExchangeItem:D,removeExchangeItem:y}});export{b as u};
